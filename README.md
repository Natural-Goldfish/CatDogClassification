# Introduction  
    
</br></br>
# How to use my code  
- In order to use my code, just follow this :  
```
    git clone -b master https://github.com/Natural-Goldfish/CatDogClassification.git  
```
```
    cd CatDogClassification\\Classification
```  
**❗ You must choose wihch mode you will run between _'train' or 'test'_.**
```
    python main.py --mode {}
```
- For more specific information how to run my code, you could run :
```  
    python main.py -h  
```
</br></br>

# Requirements
```
    - python 3.7.1
    - pytorch 1.6.0
    - opencv 4.4.0
    - numpy 1.15.4  
```
</br></br>

# Project Structure  
This will help you understand where the code files exist and where the data, kind of images and weight files, are stored. The structure looks like below :  
```
    Classification
    ├──data
    │   ├──Kaggle
    │   │   ├──test_set
    │   │   │   ├──cats
    │   │   │   │   ├──cat.4001.jpg
    │   │   │   │   ├──cat.4002.jpg
    │   │   │   │   └──...
    │   │   │   └──dogs
    │   │   │       ├──dog.4001.jpg
    │   │   │       ├──dog.4002.jpg
    │   │   │       └──...    
    │   │   └──training_set
    │   │       ├──cats
    │   │       │   ├──cat.1.jpg
    │   │       │   ├──cat.2.jpg
    │   │       │   └──...
    │   │       └──dogs
    │   │           ├──dog.1.jpg
    │   │           ├──dog.2.jpg
    │   │           └──...
    │   ├──images
    │   │   ├──test
    │   │   │   ├──0.jpg
    │   │   │   ├──1.jpg
    │   │   │   └──... 
    │   │   └──train
    │   │       ├──0.jpg
    │   │       ├──1.jpg
    │   │       └──...       
    │   ├──annotations
    │   │   ├──test_annotation.json
    │   │   └──train_annotation.json
    │   ├──models
    │   │   ├──CatDogClassifier_{layer}_{epoch}_checkpoint.pth
    │   │   └──Vgg16_{epoch}_checkpoint.pth
    │   └──samples
    │       ├──sample_0.jpg
    │       ├──sample_0.jpg
    │       └──...
    ├──src
    │   ├──__init__.py
    │   ├──data_argumentation.py
    │   ├──dataset.py
    │   ├──network.py
    │   └──utils.py
    ├──__init__.py
    ├──main.py
    ├──make_annotation.py
    ├──training.py
    └──testing.py  
```
</br></br>

# Dataset  
I used  _"[Cats and Dogs](https://www.kaggle.com/tongpython/cat-and-dog)"_ dataset in Kaggle, in which there are 8004 images for training and 2022 images for testing. The  structure looks like below :  

```
    Dataset
    ├──test_set
    │   └──test_set    
    │      ├──cats
    │      │   ├──_DS_Store
    │      │   ├──cat.4001.jpg
    │      │   ├──cat.4002.jpg
    │      │   └──...
    │      └──dogs
    │          ├──_DS_Store
    │          ├──dog.4001.jpg
    │          ├──dog.4002.jpg
    │          └──...
    │      
    └──training_set
        └──training_set   
           ├──cats
           │   ├──_DS_Store
           │   ├──cat.1.jpg
           │   ├──cat.2.jpg
           │   └──...
           └──dogs
               ├──_DS_Store
               ├──dog.1.jpg
               ├──dog.2.jpg
               └──...
```  
In order to make this structure simple and make annotation files for training, I used _```make_annotation.py```_.
The annotation file written by json have three imformation of images, which are _identification_, _class name_ and _image size_.
Honestly, in this project, the original image size doens't need. But I did it to practice the way to make an annotation file for the other projects kind of _Object Detection_.
The new images and annotation files which are generated by _make_annotation.py_ are saved to _```'data/images'```_ and _```'data/annotations'```_ for each. The annotation file looks like below, which is a part of _```test_annotation.json```_. :   

```
[
    {
        "id" : 0,
        "class_name" : "cat",
        "image_size" : {
            "height" : 415,
            "width" : 498
        }
    },
    {
        "id": 1,
        "class_name": "cat",
        "image_size": {
            "height": 499,
            "width": 375
        }
    },
    ...
    {
        "id": 2021,
        "class_name": "dog",
        "image_size": {
            "height": 396,
            "width": 499
        }
    },
    {
        "id": 2022,
        "class_name": "dog",
        "image_size": {
            "height": 374,
            "width": 500
        }
    }
]
```
 The following images are some of the dataset images.</br></br>
<p align="center"><img src='https://github.com/Natural-Goldfish/SimpsonGenerator/blob/master/SimpsonGenerator/data/images/1.png' width = "200px" height = "200px"/>
<img src='https://github.com/Natural-Goldfish/SimpsonGenerator/blob/master/SimpsonGenerator/data/images/4.png' width = "200px" height = "200px"/>
<img src='https://github.com/Natural-Goldfish/SimpsonGenerator/blob/master/SimpsonGenerator/data/images/3.png' width = "200px" height = "200px"/>
<img src='https://github.com/Natural-Goldfish/SimpsonGenerator/blob/master/SimpsonGenerator/data/images/14.png' width = "200px" height = "200px"/></p>
</br></br>

# Settings  
- **Model Structure**</br></br>
I followed DC-GAN paper's model architecture</br></br>
- **Loss**</br></br>
I used _BCELoss_ in pytorch</br></br>
- **Optimizer**</br></br>
I used _Adam optimizer_ with the β1 and β2 of default values. _Learning rate : 2e-4_</br></br>
- **Data Argumentation**</br></br>
I performed data argumentation to make model more stable and to complement the small dataset. Techniques applied here are _resize_, _normalization_, _horizontal flip with random probability_.  
</br></br>

# Train  
I trained the model for _400 epochs_ about the dataset by _64 batch size_. You can find this pre-trained model's parameter file in _```'data\models'```_  
The update cycle of disciminator model for each batch size is a little bit changed comapred to the paper.  
| Epoch | Discriminator : Generator |  
|:---:|:---:|
| 0 ~ 50 | 1 : 2 |
| 50 ~ end | 1 : 1|  
- If you want to train this model from beginning, you could run :  
```
python main.py --mode train
```
- If you want to train pre-trained model, you could run :  
``` 
python main.py --mode train --model_load_flag --generator_load_name {} --discriminator_load_name {}
```
</br></br>

# Test  
You can generate images using pre-trained model, which are saved in _```'data\generated_images'```_  
- If you want to see a generated image which pre-trained model make, just run :  
``` 
python main.py --mode test
```  
- Also you can choice the number of images to generate by changing _**'--generate_numbers'**_, you could run :  
``` 
python main.py --mode test --generate_numbers {}
```  
- If you want to change the directory as well, you could run :  
``` 
python main.py --mode test --generating_model_name {} --image_save_path {} --generate_numbers {}
```  
</br></br>

# Results  
Some generated images are shown below :</br></br>
<p align="center"><img src='https://github.com/Natural-Goldfish/SimpsonGenerator/blob/master/SimpsonGenerator/data/generated_images/Generated_img0.jpg' width = "100px" height = "100px"/>
<img src='https://github.com/Natural-Goldfish/SimpsonGenerator/blob/master/SimpsonGenerator/data/generated_images/Generated_img2.jpg' width = "100px" height = "100px"/>
<img src='https://github.com/Natural-Goldfish/SimpsonGenerator/blob/master/SimpsonGenerator/data/generated_images/Generated_img3.jpg' width = "100px" height = "100px"/>
<img src='https://github.com/Natural-Goldfish/SimpsonGenerator/blob/master/SimpsonGenerator/data/generated_images/Generated_img4.jpg' width = "100px" height = "100px"/>
<img src='https://github.com/Natural-Goldfish/SimpsonGenerator/blob/master/SimpsonGenerator/data/generated_images/Generated_img5.jpg' width = "100px" height = "100px"/>
<img src='https://github.com/Natural-Goldfish/SimpsonGenerator/blob/master/SimpsonGenerator/data/generated_images/Generated_img6.jpg' width = "100px" height = "100px"/>
<img src='https://github.com/Natural-Goldfish/SimpsonGenerator/blob/master/SimpsonGenerator/data/generated_images/Generated_img7.jpg' width = "100px" height = "100px"/>
<img src='https://github.com/Natural-Goldfish/SimpsonGenerator/blob/master/SimpsonGenerator/data/generated_images/Generated_img8.jpg' width = "100px" height = "100px"/>
<img src='https://github.com/Natural-Goldfish/SimpsonGenerator/blob/master/SimpsonGenerator/data/generated_images/Generated_img9.jpg" width = "100px" height = "100px"/></p>



